<html>
<head>
<title>Sample Application for RSA signing in JavaScript</title>
<script language="JavaScript" type="text/javascript" src="ext/jsbn.js"></script>
<script language="JavaScript" type="text/javascript" src="ext/jsbn2.js"></script>
<script language="JavaScript" type="text/javascript" src="ext/rsa.js"></script>
<script language="JavaScript" type="text/javascript" src="ext/rsa2.js"></script>
<script language="JavaScript" type="text/javascript" src="ext/base64.js"></script>

<!-- for crypto.js -->
<script src="http://yui.yahooapis.com/2.9.0/build/yahoo/yahoo-min.js"></script>
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/components/core.js"></script>
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/components/md5.js"></script>
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/components/sha1.js"></script>
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/components/sha256.js"></script>
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/components/ripemd160.js"></script>
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/components/x64-core.js"></script>
<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/components/sha512.js"></script>

<script language="JavaScript" type="text/javascript" src="rsapem-1.1.js"></script>
<script language="JavaScript" type="text/javascript" src="rsasign-1.2.js"></script>
<script language="JavaScript" type="text/javascript" src="asn1hex-1.1.js"></script>
<script language="JavaScript" type="text/javascript" src="x509-1.1.js"></script>
<script language="JavaScript" type="text/javascript" src="crypto-1.1.js"></script>
<script language="JavaScript" type="text/javascript">
function doSign() {
  var rsa = new RSAKey();
  rsa.readPrivateKeyFromPEMString(document.form1.prvkey1.value);
  var hashAlg = document.form1.hashalg.value;
  var hSig = rsa.signString(document.form1.msgsigned.value, hashAlg);

  //document.form1.siggenerated.value = linebrk(hSig, 64);

  document.form1.siggenerated.value  = hex2b64(hSig);
}

function doVerify() {
  var sMsg = document.form1.msgverified.value;
  var hSig = document.form1.sigverified.value;

  var x509 = new X509();
  x509.readCertPEM(document.form1.cert.value);
  var isValid = x509.subjectPublicKeyRSA.verifyString(sMsg, hSig);

  // display verification result
  if (isValid) {
    _displayStatus("valid");
  } else {
    _displayStatus("invalid");
  }
}

function copyMsgAndSig() {
  _displayStatus("reset");
  document.form1.msgverified.value = document.form1.msgsigned.value; 
  document.form1.sigverified.value = document.form1.siggenerated.value; 
}

function _displayStatus(sStatus) {
  var div1 = document.getElementById("verifyresult");
  if (sStatus == "valid") {
    div1.style.backgroundColor = "skyblue";
    div1.innerHTML = "This signature is *VALID*.";
  } else if (sStatus == "invalid") {
    div1.style.backgroundColor = "deeppink";
    div1.innerHTML = "This signature is *NOT VALID*.";
  } else {
    div1.style.backgroundColor = "yellow";
    div1.innerHTML = "Please fill values below and push [Verify this sigunature] button.";
  }
}

</script>
<style type="text/css">
TD  {vertical-align: top}
</style>
</head>
<body>
<h1>Sample Application for RSA signing in JavaScript</h1>

<form name="form1">
<table border="0">
<tr><th>Signer</th><th></th><th>Verifier</th></tr>

<tr>
<td>
PEM RSA Private Key<br/>
<textarea name="prvkey1" rows="10" cols="65">
-----BEGIN RSA PRIVATE KEY-----
MIICWgIBAAKBgGcpfqrh++lSMRIaqhveIcDMwMklT+y2w6iIO5aJitEPXkT/XkwH
bmfNOTA982ndTh7bEntnAKV0hAJYn8iLjLOGbBLA+lJKSZB8g0CEh2Rqkaf1aAyj
Iqt7huYcGdjSCOdQb2FICYB15FF6IFxBU5rwqcq3nIjDnitQRujzod6NAgMBAAEC
gYAZbS/MPIDThC+WD75nuftFwvGtYiXt6SoWauWM9/+gAZKxnOOIB7jdmsaCrnJF
YId1sXc/tSaCoVI8Jc3UJxkZgXuXn6gu9xdpywtB7J+i3Lp+XengQM0Sy2C75S65
rDaaMqirFYTtSvyIauaqhIgRujAVTvXh3z/HPs4/R5eK/QJBAL0VGj//kYh7oCdl
3AvMIxHNCHs2o03FiP5iwtKjbCuT7wuI2E3HGexCVndk1O9q8eGPYrk1l8KMzEDd
Xg6M/a8CQQCLq/73Tpzzd61x3PQDTSoLMzpPagkLG9BW07v888m2miTMlMr3sRbO
MiW/P55oc63LKfIYsRE41AetrtSj5lKDAkAQrczb+lpHFMii0QxhCgfJ6TEnVUGA
eb1E20deN0YybeE3PkH+UmLKAWwJKh7SY7ekcvZ9aenSIoNd8Wj7lZpHAkB2jLRK
oNUi6a+z94C91J8dBow1n6CxZxg8ulbTavEJJmiZpKlp90uOFI5pd8wyiA05Zg7w
2knt3DnwN3aQ7wuVAkAFtkrckXd/O2RK9L4Ksp7oBE4vULB8lvnXcx8N4E3OyPRP
MkHV8DG6BLWpz7vlPR3DkTWrCSp7lURhkqIztiau
-----END RSA PRIVATE KEY-----
</textarea><br/>
Text message to be signed.<br/>
<input type="text" name="msgsigned" size="100" value="aaa"/><br/>
</td>
<td></td>
<td>
Verification Result
<div id="verifyresult" style="background: yellow">Please fill values below and push "Verify this sigunature" button.</div>
</td>
</tr>

<tr>
<td>
<select name="hashalg">
<option value="sha1" selected>SHA1
<option value="sha256">SHA256
<option value="sha512">SHA512
<option value="md5">MD5
<option value="ripemd160">RIPEMD-160
</select>
<input type="button" value="Sign to this message &darr;" onClick="doSign();"/><br/>
</td>
<td>
<input type="button" value="Copy &rarr;" onClick="copyMsgAndSig();"/><br/>
</td>
<td>
<input type="button" value="Verify this signature &uarr;" onClick="doVerify();"/><br/>
</td>
</tr>

<tr>
<td>
Generated Signature<br/>
<textarea name="siggenerated" rows="4" cols="65"></textarea>
</td>
<td>
</td>
<td>
Verifying Signature<br/>
<textarea name="sigverified" rows="4" cols="65">
6f7df91d8f973a0619d525c319337741130b77b21f9667dc7d1d74853b644cbe
5e6b0e84aacc2faee883d43affb811fc653b67c38203d4f206d1b838c4714b6b
2cf17cd621303c21bac96090df3883e58784a0576e501c10cdefb12b6bf887e5
48f6b07b09ae80d8416151d7dab7066d645e2eee57ac5f7af2a70ee0724c8e47
</textarea><br/>
Text message to be verified.<br/>
<input type="text" name="msgverified" size="100" value="aaa"/><br/>
Signer's Public Key Certificate.<br/>
<textarea name="cert" rows="10" cols="65">
-----BEGIN PUBLIC KEY-----
MIGeMA0GCSqGSIb3DQEBAQUAA4GMADCBiAKBgGcpfqrh++lSMRIaqhveIcDMwMkl
T+y2w6iIO5aJitEPXkT/XkwHbmfNOTA982ndTh7bEntnAKV0hAJYn8iLjLOGbBLA
+lJKSZB8g0CEh2Rqkaf1aAyjIqt7huYcGdjSCOdQb2FICYB15FF6IFxBU5rwqcq3
nIjDnitQRujzod6NAgMBAAE=
-----END PUBLIC KEY-----
</textarea><br/>
</td>
</tr>

</table>
</form>

<h3>How to sign and verify a text message (simple usage)</h3>
<ol>
<li>Modify the text message 'aaa' to anything you want.</li>
<li>Choose hash algorithm for signing 'SHA1' or 'SHA256'.</li>
<li>Push 'Sign to this message' button in the left.</li>
<li>Push 'Copy' button in the middle to copy the message to be signed and the generated signature value to verification form in the right.</li>
<li>Push 'Verify this message' in the right.</li>
<li>Then you can see signature verification result in the top of right.</li>
</ol>
<h3>Note for signing in the left form.</h3>
See below when you want to specify message and private key to be signed.
<ul>
<li>In the 'PEM RSA Private Key' text area, you can specify
signer's private key. The format of the key should be
PKCS#1 PEM text formatted and unencrypted RSA private key.</li>
</ul>

<h3>Note for signature verification in the right form.</h3>
See below when you want to specify message,
signature value and public key certificate to be verified.
<ul>
<li>In the 'Verifying Signature' field, you can specify
any signature value to be verified.
Signature value should be hexa decimal encoded 'RSASSA-PKCS1-v1_5' signature.
Currently this supports 'SHA1withRSA' and 'SHA256withRSA' signature algorihtm.
RSA key length have been tested from 512bit to 2048bit for this program.
</li>
<li>
In the "Signer's Public Key Certificate" field, 
you can specify signer's public key certificate to be verified.
The value should be PEM encoded X.509 certificate with RSA public key.
X.509v1 and X.509v3 is available however X.509v2 is not supported now.
</li>
</ul>
<center>
Copyright &copy; 2010-2012 Kenji Urushima, All Rights Reserved.
</center>

<div align="right">
<a href="index.html">Go back to index</a>
</div>

<div align="right">
<a href="http://blog.livedoor.jp/k_urushima/" target="_blank" alt="kjur's blog">
<img src="http://www9.atwiki.jp/kurushima/pub/icon/icon_livedoor_blog.gif" border="0" width="20"/>
</a>
<a href="http://www9.atwiki.jp/kurushima/" target="_blank" alt="kjur's wiki">
<img src="http://www9.atwiki.jp/kurushima/pub/icon/icon_atwiki.gif" border="0" width="20"/>
</a>
<a href="http://twitter.com/kjur/" target="_blank" alt="kjur on twitter">
<img src="http://www9.atwiki.jp/kurushima/pub/icon/icon_twitter.gif" border="0" width="20"/>
</a>
<a href="http://x5.choumusubi.com/bin/gg?069823300">
<img src="http://x5.choumusubi.com/bin/ll?069823300" border="0" width="20"/>
</a>
</div>
</body>
</html>
