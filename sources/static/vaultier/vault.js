Vaultier.VaultsIndexRoute=Ember.Route.extend(Vaultier.WorkspaceKeysMixin,{beforeModel:function(){this.checkWorkspaceKeys()},model:function(){var e=this.modelFor("Workspace"),t=this.get("store"),r=t.find("Vault",{workspace:e.get("id")}),a=t.find("Role",{to_workspace:e.get("id")}).then(function(e){return e.toArray()});return Ember.RSVP.hash({vaults:r,memberships:a})},setupController:function(e,t){e.set("content",t.vaults),e.set("memberships",t.memberships);var r=this.modelFor("Workspace");this.set("workspace",r),e.set("workspace",r),e.set("breadcrumbs",Vaultier.Breadcrumbs.create({router:this.get("router"),environment:this.get("environment")}).addHome().addWorkspace())}}),Vaultier.VaultsIndexController=Ember.ArrayController.extend({breadcrumbs:null}),Vaultier.VaultsIndexView=Ember.View.extend({templateName:"Vault/VaultsIndex",layoutName:"Layout/LayoutStandard"}),Vaultier.VaultIndexItemView=Ember.View.extend({templateName:"Vault/VaultsIndexItem"});
Vaultier.VaultsCreateRoute=Ember.Route.extend(Vaultier.WorkspaceKeysMixin,{beforeModel:function(){this.checkWorkspaceKeys()},model:function(e,t){var r=this.get("store"),o=this.modelFor("Workspace");if(this.get("auth").checkPermissions(t,function(){return o.get("perms.create")}.bind(this),!0)){var s=r.createRecord("Vault"),a=r.find("Role",{to_workspace:o.get("id")}).then(function(e){return e.toArray()});return Ember.RSVP.hash({vault:s,memberships:a})}},actions:{save:function(){var e=(this.get("workspace"),this.get("controller.content"));e.set("workspace",this.get("workspace.id"));var t=e.saveRecord().then(function(){$.notify("Your vault has been successfully created.","success"),this.transitionTo("Vault.index",e)}.bind(this)).catch(function(e){$.notify("Oooups! Something went wrong.","error"),this.get("errors").logError(e)}.bind(this));ApplicationLoader.promise(t)}},setupController:function(e,t){e.set("content",t.vault),e.set("memberships",t.memberships);var r=this.modelFor("Workspace");this.set("workspace",r),this.get("controller").set("workspace",r),e.set("breadcrumbs",Vaultier.Breadcrumbs.create({router:this.get("router"),environment:this.get("environment")}).addHome().addWorkspace().addText("Create new vault"))}}),Vaultier.VaultsCreateController=Ember.ObjectController.extend({workspace:null,breadcrumbs:null,env:null}),Vaultier.VaultsCreateView=Ember.View.extend({templateName:"Vault/VaultsCreate",layoutName:"Layout/LayoutStandard"});
Vaultier.VaultRoute=Ember.Route.extend(Vaultier.WorkspaceKeysMixin,{model:function(e){return workspace=this.modelFor("Workspace"),model=this.get("store").find("Vault",e.vault).then(function(e){if(e.get("workspace")!=workspace.get("id")){var t=new Error;throw t.status=404,t}return e})},afterModel:function(e){var t=this.get("environment");t.set("vault",e),this.checkWorkspaceKeys()},serialize:function(e){return"string"==typeof e||"number"==typeof e?e:{vault:e.get("slug")}},actions:{deleteVault:function(e){Vaultier.confirmModal(this,"Are you sure?",function(){var t=e.deleteRecord().then(function(){$.notify("Your vault has been successfully deleted.","success"),this.transitionTo("Workspace.index")}.bind(this),function(){$.notify("Oooups! Something went wrong.","error")}.bind(this));ApplicationLoader.promise(t)}.bind(this))}}}),Vaultier.VaultIndexRoute=Ember.Route.extend(Vaultier.WorkspaceKeysMixin,{beforeModel:function(){this.checkWorkspaceKeys()&&this.transitionTo("Cards.index")}});
Vaultier.VaultEditRoute=Ember.Route.extend(Vaultier.WorkspaceKeysMixin,{beforeModel:function(){this.checkWorkspaceKeys()},model:function(e,t){var r=this.modelFor("Vault");if(this.get("auth").checkPermissions(t,function(){return r.get("perms.update")}.bind(this),!0))return r},setupController:function(e,t){this._super(e,t);var r=this.get("environment");r.set("vault",t),e.set("breadcrumbs",Vaultier.Breadcrumbs.create({router:this.get("router"),environment:r}).addHome().addWorkspace().addVault().addText("Edit vault"))},actions:{save:function(){var e=this.get("controller.content"),t=e.saveRecord().then(function(){$.notify("Your changes has been successfully saved.","success"),history.go(-1)}.bind(this)).catch(function(e){$.notify("Oooups! Something went wrong.","error"),this.get("errors").logError(e)}.bind(this));ApplicationLoader.promise(t)}}}),Vaultier.VaultEditController=Ember.ObjectController.extend({breadcrumbs:null}),Vaultier.VaultEditView=Ember.View.extend({templateName:"Vault/VaultEdit",layoutName:"Layout/LayoutStandard"});
Vaultier.VaultMemberIndexRoute=Vaultier.MemberIndexRoute.extend(Vaultier.WorkspaceKeysMixin,{beforeModel:function(){this.checkWorkspaceKeys()},setupInviteData:function(){var e=this.modelFor("Vault");return{inviteObject:e}},setupBlocks:function(){return{workspace:!0,vault:!0}},setupBreadcrumbs:function(){return Vaultier.Breadcrumbs.create({router:this.get("router"),environment:this.get("environment")}).addHome().addWorkspace().addVault().addCollaboratorsIndex("Vault.memberIndex")},setupInviteRoute:function(){return{inviteRouteName:"Vault.memberInvite"}}}),Vaultier.VaultMemberIndexController=Vaultier.MemberIndexController.extend({}),Vaultier.VaultMemberInviteRoute=Vaultier.MemberInviteRoute.extend(Vaultier.WorkspaceKeysMixin,{beforeModel:function(){this.checkWorkspaceKeys()},setupInviteData:function(){var e=this.modelFor("Vault"),t=this.modelFor("Workspace");return{inviteObject:e,inviteParams:{to_vault:e},inviteWorkspace:t}},setupBreadcrumbs:function(){return Vaultier.Breadcrumbs.create({router:this.get("router"),environment:this.get("environment")}).addHome().addWorkspace().addVault().addCollaboratorsIndex("Vault.memberIndex").addCollaboratorsInvite("Vault.memberInvite")}}),Vaultier.VaultMemberInviteController=Vaultier.MemberInviteController.extend({});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlZhdWx0c0luZGV4LmpzIiwiVmF1bHRzQ3JlYXRlLmpzIiwiVmF1bHRJbmRleC5qcyIsIlZhdWx0RWRpdC5qcyIsIlZhdWx0TWVtYmVyLmpzIl0sIm5hbWVzIjpbIlZhdWx0aWVyIiwiVmF1bHRzSW5kZXhSb3V0ZSIsIkVtYmVyIiwiUm91dGUiLCJleHRlbmQiLCJXb3Jrc3BhY2VLZXlzTWl4aW4iLCJiZWZvcmVNb2RlbCIsInRoaXMiLCJjaGVja1dvcmtzcGFjZUtleXMiLCJtb2RlbCIsIndvcmtzcGFjZSIsIm1vZGVsRm9yIiwic3RvcmUiLCJnZXQiLCJ2YXVsdHMiLCJmaW5kIiwibWVtYmVyc2hpcHMiLCJ0b193b3Jrc3BhY2UiLCJ0aGVuIiwidG9BcnJheSIsIlJTVlAiLCJoYXNoIiwic2V0dXBDb250cm9sbGVyIiwiY3RybCIsInNldCIsIkJyZWFkY3J1bWJzIiwiY3JlYXRlIiwicm91dGVyIiwiZW52aXJvbm1lbnQiLCJhZGRIb21lIiwiYWRkV29ya3NwYWNlIiwiVmF1bHRzSW5kZXhDb250cm9sbGVyIiwiQXJyYXlDb250cm9sbGVyIiwiYnJlYWRjcnVtYnMiLCJWYXVsdHNJbmRleFZpZXciLCJWaWV3IiwidGVtcGxhdGVOYW1lIiwibGF5b3V0TmFtZSIsIlZhdWx0SW5kZXhJdGVtVmlldyIsIlZhdWx0c0NyZWF0ZVJvdXRlIiwicGFyYW1zIiwidHJhbnNpdGlvbiIsImNoZWNrUGVybWlzc2lvbnMiLCJiaW5kIiwidmF1bHQiLCJjcmVhdGVSZWNvcmQiLCJhY3Rpb25zIiwic2F2ZSIsInJlY29yZCIsInByb21pc2UiLCJzYXZlUmVjb3JkIiwiJCIsIm5vdGlmeSIsInRyYW5zaXRpb25UbyIsImNhdGNoIiwiZXJyb3IiLCJsb2dFcnJvciIsIkFwcGxpY2F0aW9uTG9hZGVyIiwiYWRkVGV4dCIsIlZhdWx0c0NyZWF0ZUNvbnRyb2xsZXIiLCJPYmplY3RDb250cm9sbGVyIiwiZW52IiwiVmF1bHRzQ3JlYXRlVmlldyIsIlZhdWx0Um91dGUiLCJFcnJvciIsInN0YXR1cyIsImFmdGVyTW9kZWwiLCJzZXJpYWxpemUiLCJkZWxldGVWYXVsdCIsImNvbmZpcm1Nb2RhbCIsImRlbGV0ZVJlY29yZCIsIlZhdWx0SW5kZXhSb3V0ZSIsIlZhdWx0RWRpdFJvdXRlIiwiX3N1cGVyIiwiYWRkVmF1bHQiLCJoaXN0b3J5IiwiZ28iLCJWYXVsdEVkaXRDb250cm9sbGVyIiwiVmF1bHRFZGl0VmlldyIsIlZhdWx0TWVtYmVySW5kZXhSb3V0ZSIsIk1lbWJlckluZGV4Um91dGUiLCJzZXR1cEludml0ZURhdGEiLCJpbnZpdGVPYmplY3QiLCJzZXR1cEJsb2NrcyIsInNldHVwQnJlYWRjcnVtYnMiLCJhZGRDb2xsYWJvcmF0b3JzSW5kZXgiLCJzZXR1cEludml0ZVJvdXRlIiwiaW52aXRlUm91dGVOYW1lIiwiVmF1bHRNZW1iZXJJbmRleENvbnRyb2xsZXIiLCJNZW1iZXJJbmRleENvbnRyb2xsZXIiLCJWYXVsdE1lbWJlckludml0ZVJvdXRlIiwiTWVtYmVySW52aXRlUm91dGUiLCJpbnZpdGVQYXJhbXMiLCJ0b192YXVsdCIsImludml0ZVdvcmtzcGFjZSIsImFkZENvbGxhYm9yYXRvcnNJbnZpdGUiLCJWYXVsdE1lbWJlckludml0ZUNvbnRyb2xsZXIiLCJNZW1iZXJJbnZpdGVDb250cm9sbGVyIl0sIm1hcHBpbmdzIjoiQUFBQUEsU0FBU0MsaUJBQW1CQyxNQUFNQyxNQUFNQyxPQUNwQ0osU0FBU0ssb0JBR0xDLFlBQWEsV0FDVEMsS0FBS0Msc0JBR1RDLE1BQU8sV0FDSCxHQUFJQyxHQUFZSCxLQUFLSSxTQUFTLGFBQzFCQyxFQUFRTCxLQUFLTSxJQUFJLFNBR2pCQyxFQUFTRixFQUFNRyxLQUFLLFNBQVVMLFVBQVdBLEVBQVVHLElBQUksUUFHdkRHLEVBQWNKLEVBQ2JHLEtBQUssUUFBU0UsYUFBY1AsRUFBVUcsSUFBSSxRQUMxQ0ssS0FBSyxTQUFVRixHQUNaLE1BQU9BLEdBQVlHLFdBSTNCLE9BQU9qQixPQUFNa0IsS0FBS0MsTUFDZFAsT0FBUUEsRUFDUkUs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T0FDekRKLFNBQVNLLG9CQUdMQyxZQUFhLFdBQ1RDLEtBQUtDLHNCQU1UeUUsZ0JBQWlCLFdBQ2IsR0FBSXJDLEdBQVFyQyxLQUFLSSxTQUFTLFNBQ3RCRCxFQUFZSCxLQUFLSSxTQUFTLFlBQzlCLFFBQ0l1RSxhQUFjdEMsRUFDZGdELGNBQWdCQyxTQUFVakQsR0FDMUJrRCxnQkFBaUJwRixJQUl6QjBFLGlCQUFrQixXQUNkLE1BQU9wRixVQUFTeUIsWUFBWUMsUUFBUUMsT0FBUXBCLEtBQUtNLElBQUksVUFBV2UsWUFBYXJCLEtBQUtNLElBQUksaUJBQ2pGZ0IsVUFDQUMsZUFDQTRDLFdBQ0FXLHNCQUFzQixxQkFDdEJVLHVCQUF1Qix5QkFLeEMvRixTQUFTZ0csNEJBQThCaEcsU0FBU2lHLHVCQUF1QjdGIiwiZmlsZSI6InZhdWx0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiVmF1bHRpZXIuVmF1bHRzSW5kZXhSb3V0ZSA9IEVtYmVyLlJvdXRlLmV4dGVuZChcbiAgICBWYXVsdGllci5Xb3Jrc3BhY2VLZXlzTWl4aW4sXG4gICAge1xuXG4gICAgICAgIGJlZm9yZU1vZGVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmNoZWNrV29ya3NwYWNlS2V5cygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG1vZGVsOiBmdW5jdGlvbiAocGFyYW1zLCBxdWVyeVBhcmFtcykge1xuICAgICAgICAgICAgdmFyIHdvcmtzcGFjZSA9IHRoaXMubW9kZWxGb3IoJ1dvcmtzcGFjZScpO1xuICAgICAgICAgICAgdmFyIHN0b3JlID0gdGhpcy5nZXQoJ3N0b3JlJyk7XG5cbiAgICAgICAgICAgIC8vIHJldHJpZXZlIHZhdWx0c1xuICAgICAgICAgICAgdmFyIHZhdWx0cyA9IHN0b3JlLmZpbmQoJ1ZhdWx0Jywge3dvcmtzcGFjZTogd29ya3NwYWNlLmdldCgnaWQnKX0pO1xuXG4gICAgICAgICAgICAvLyBsb2FkIG1lbWJlcnNoaXBzXG4gICAgICAgICAgICB2YXIgbWVtYmVyc2hpcHMgPSBzdG9yZVxuICAgICAgICAgICAgICAgIC5maW5kKCdSb2xlJywge3RvX3dvcmtzcGFjZTogd29ya3NwYWNlLmdldCgnaWQnKSB9KVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChtZW1iZXJzaGlwcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWVtYmVyc2hpcHMudG9BcnJheSgpXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIHJldHVybiBwcm9taXNlIGZvciBhbGwgcmVxdWVzdHNcbiAgICAgICAgICAgIHJldHVybiBFbWJlci5SU1ZQLmhhc2goe1xuICAgICAgICAgICAgICAgIHZhdWx0czogdmF1bHRzLFxuICAgICAgICAgICAgICAgIG1lbWJlcnNoaXBzOiBtZW1iZXJzaGlwc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0dXBDb250cm9sbGVyOiBmdW5jdGlvbiAoY3RybCwgbW9kZWwpIHtcbiAgICAgICAgICAgIC8vIHNldCBtb2RlbFxuICAgICAgICAgICAgY3RybC5zZXQoJ2NvbnRlbnQnLCBtb2RlbC52YXVsdHMpO1xuICAgICAgICAgICAgY3RybC5zZXQoJ21lbWJlcnNoaXBzJywgbW9kZWwubWVtYmVyc2hpcHMpO1xuXG4gICAgICAgICAgICAvLyByZXRyaWV2ZSB3b3Jrc3BhY2VcbiAgICAgICAgICAgIHZhciB3b3Jrc3BhY2UgPSB0aGlzLm1vZGVsRm9yKCdXb3Jrc3BhY2UnKTtcbiAgICAgICAgICAgIHRoaXMuc2V0KCd3b3Jrc3BhY2UnLCB3b3Jrc3BhY2UpO1xuICAgICAgICAgICAgY3RybC5zZXQoJ3dvcmtzcGFjZScsIHdvcmtzcGFjZSk7XG5cbiAgICAgICAgICAgIC8vIHNldCBicmVhZGNydW1ic1xuICAgICAgICAgICAgY3RybC5zZXQoJ2JyZWFkY3J1bWJzJyxcbiAgICAgICAgICAgICAgICBWYXVsdGllci5CcmVhZGNydW1icy5jcmVhdGUoe3JvdXRlcjogdGhpcy5nZXQoJ3JvdXRlcicpLCBlbnZpcm9ubWVudDogdGhpcy5nZXQoJ2Vudmlyb25tZW50Jyl9KVxuICAgICAgICAgICAgICAgICAgICAuYWRkSG9tZSgpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRXb3Jrc3BhY2UoKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG5cblZhdWx0aWVyLlZhdWx0c0luZGV4Q29udHJvbGxlciA9IEVtYmVyLkFycmF5Q29udHJvbGxlci5leHRlbmQoe1xuICAgIGJyZWFkY3J1bWJzOiBudWxsXG59KTtcblxuXG5WYXVsdGllci5WYXVsdHNJbmRleFZpZXcgPSBFbWJlci5WaWV3LmV4dGVuZCh7XG4gICAgdGVtcGxhdGVOYW1lOiAnVmF1bHQvVmF1bHRzSW5kZXgnLFxuICAgIGxheW91dE5hbWU6ICdMYXlvdXQvTGF5b3V0U3RhbmRhcmQnXG59KTtcblxuXG5WYXVsdGllci5WYXVsdEluZGV4SXRlbVZpZXcgPSBFbWJlci5WaWV3LmV4dGVuZCh7XG4gICAgdGVtcGxhdGVOYW1lOiAnVmF1bHQvVmF1bHRzSW5kZXhJdGVtJ1xufSk7XG4iLCJWYXVsdGllci5WYXVsdHNDcmVhdGVSb3V0ZSA9IEVtYmVyLlJvdXRlLmV4dGVuZChcbiAgICBWYXVsdGllci5Xb3Jrc3BhY2VLZXlzTWl4aW4sXG4gICAge1xuXG4gICAgICAgIGJlZm9yZU1vZGVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmNoZWNrV29ya3NwYWNlS2V5cygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG1vZGVsOiBmdW5jdGlvbiAocGFyYW1zLCB0cmFuc2l0aW9uKSB7XG5cbiAgICAgICAgICAgIHZhciBzdG9yZSA9IHRoaXMuZ2V0KCdzdG9yZScpO1xuICAgICAgICAgICAgdmFyIHdvcmtzcGFjZSA9IHRoaXMubW9kZWxGb3IoJ1dvcmtzcGFjZScpO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMuZ2V0KCdhdXRoJykuY2hlY2tQZXJtaXNzaW9ucyh0cmFuc2l0aW9uLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHdvcmtzcGFjZS5nZXQoJ3Blcm1zLmNyZWF0ZScpXG4gICAgICAgICAgICB9LmJpbmQodGhpcyksIHRydWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBjcmVhdGUgcmVjb3JkXG4gICAgICAgICAgICB2YXIgdmF1bHQgPSBzdG9yZS5jcmVhdGVSZWNvcmQoJ1ZhdWx0Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gbG9hZCBtZW1iZXJzaGlwc1xuICAgICAgICAgICAgdmFyIG1lbWJlcnNoaXBzID0gc3RvcmVcbiAgICAgICAgICAgICAgICAuZmluZCgnUm9sZScsIHt0b193b3Jrc3BhY2U6IHdvcmtzcGFjZS5nZXQoJ2lkJykgfSlcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAobWVtYmVyc2hpcHMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lbWJlcnNoaXBzLnRvQXJyYXkoKVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyByZXR1cm4gcHJvbWlzZSBmb3IgYWxsIHJlcXVlc3RzXG4gICAgICAgICAgICByZXR1cm4gRW1iZXIuUlNWUC5oYXNoKHtcbiAgICAgICAgICAgICAgICB2YXVsdDogdmF1bHQsXG4gICAgICAgICAgICAgICAgbWVtYmVyc2hpcHM6IG1lbWJlcnNoaXBzXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9LFxuXG4gICAgICAgIGFjdGlvbnM6IHtcbiAgICAgICAgICAgIHNhdmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgd29ya3NwYWNlID0gdGhpcy5nZXQoJ3dvcmtzcGFjZScpO1xuICAgICAgICAgICAgICAgIHZhciByZWNvcmQgPSB0aGlzLmdldCgnY29udHJvbGxlci5jb250ZW50Jyk7XG4gICAgICAgICAgICAgICAgcmVjb3JkLnNldCgnd29ya3NwYWNlJywgdGhpcy5nZXQoJ3dvcmtzcGFjZS5pZCcpKTtcblxuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gcmVjb3JkXG4gICAgICAgICAgICAgICAgICAgIC5zYXZlUmVjb3JkKClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5ub3RpZnkoJ1lvdXIgdmF1bHQgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGNyZWF0ZWQuJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNpdGlvblRvKCdWYXVsdC5pbmRleCcsIHJlY29yZCk7XG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5ub3RpZnkoJ09vb3VwcyEgU29tZXRoaW5nIHdlbnQgd3JvbmcuJywgJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldCgnZXJyb3JzJykubG9nRXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgICAgICAgICAgQXBwbGljYXRpb25Mb2FkZXIucHJvbWlzZShwcm9taXNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZXR1cENvbnRyb2xsZXI6IGZ1bmN0aW9uIChjdHJsLCBtb2RlbCkge1xuICAgICAgICAgICAgIC8vIHNldCBtb2RlbFxuICAgICAgICAgICAgY3RybC5zZXQoJ2NvbnRlbnQnLCBtb2RlbC52YXVsdCk7XG4gICAgICAgICAgICBjdHJsLnNldCgnbWVtYmVyc2hpcHMnLCBtb2RlbC5tZW1iZXJzaGlwcyk7XG5cbiAgICAgICAgICAgIC8vIHJldHJpZXZlIHdvcmtzcGFjZVxuICAgICAgICAgICAgdmFyIHdvcmtzcGFjZSA9IHRoaXMubW9kZWxGb3IoJ1dvcmtzcGFjZScpO1xuICAgICAgICAgICAgdGhpcy5zZXQoJ3dvcmtzcGFjZScsIHdvcmtzcGFjZSk7XG4gICAgICAgICAgICB0aGlzLmdldCgnY29udHJvbGxlcicpLnNldCgnd29ya3NwYWNlJywgd29ya3NwYWNlKTtcblxuICAgICAgICAgICAgLy8gc2V0IGJyZWFkY3J1bWJzXG4gICAgICAgICAgICBjdHJsLnNldCgnYnJlYWRjcnVtYnMnLFxuICAgICAgICAgICAgICAgIFZhdWx0aWVyLkJyZWFkY3J1bWJzLmNyZWF0ZSh7cm91dGVyOiB0aGlzLmdldCgncm91dGVyJyksIGVudmlyb25tZW50OiB0aGlzLmdldCgnZW52aXJvbm1lbnQnKX0pXG4gICAgICAgICAgICAgICAgICAgIC5hZGRIb21lKClcbiAgICAgICAgICAgICAgICAgICAgLmFkZFdvcmtzcGFjZSgpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRUZXh0KCdDcmVhdGUgbmV3IHZhdWx0JylcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgfVxuICAgIH0pO1xuXG5WYXVsdGllci5WYXVsdHNDcmVhdGVDb250cm9sbGVyID0gRW1iZXIuT2JqZWN0Q29udHJvbGxlci5leHRlbmQoe1xuICAgIHdvcmtzcGFjZTogbnVsbCxcbiAgICBicmVhZGNydW1iczogbnVsbCxcbiAgICBlbnY6IG51bGxcbn0pO1xuXG5WYXVsdGllci5WYXVsdHNDcmVhdGVWaWV3ID0gRW1iZXIuVmlldy5leHRlbmQoe1xuICAgIHRlbXBsYXRlTmFtZTogJ1ZhdWx0L1ZhdWx0c0NyZWF0ZScsXG4gICAgbGF5b3V0TmFtZTogJ0xheW91dC9MYXlvdXRTdGFuZGFyZCdcbn0pO1xuIiwiVmF1bHRpZXIuVmF1bHRSb3V0ZSA9IEVtYmVyLlJvdXRlLmV4dGVuZChcbiAgICBWYXVsdGllci5Xb3Jrc3BhY2VLZXlzTWl4aW4sXG4gICAge1xuICAgICAgICBtb2RlbDogZnVuY3Rpb24gKHBhcmFtcywgdHJhbnNpdGlvbikge1xuICAgICAgICAgICAgd29ya3NwYWNlID0gdGhpcy5tb2RlbEZvcignV29ya3NwYWNlJyk7XG4gICAgICAgICAgICBtb2RlbCA9IHRoaXMuZ2V0KCdzdG9yZScpXG4gICAgICAgICAgICAgICAgLmZpbmQoJ1ZhdWx0JywgcGFyYW1zLnZhdWx0KVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChtb2RlbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobW9kZWwuZ2V0KCd3b3Jrc3BhY2UnKSAhPSB3b3Jrc3BhY2UuZ2V0KCdpZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSBuZXcgRXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yLnN0YXR1cyA9IDQwNDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtb2RlbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBtb2RlbDtcbiAgICAgICAgfSxcblxuICAgICAgICBhZnRlck1vZGVsOiBmdW5jdGlvbiAodmF1bHQpIHtcbiAgICAgICAgICAgIHZhciBlbnZpcm9ubWVudCA9IHRoaXMuZ2V0KCdlbnZpcm9ubWVudCcpO1xuICAgICAgICAgICAgZW52aXJvbm1lbnQuc2V0KCd2YXVsdCcsIHZhdWx0KTtcbiAgICAgICAgICAgIHRoaXMuY2hlY2tXb3Jrc3BhY2VLZXlzKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2VyaWFsaXplOiBmdW5jdGlvbiAobW9kZWwpIHtcbiAgICAgICAgICAgIC8vIHByaW1pdGl2ZXNcbiAgICAgICAgICAgIGlmICh0eXBlb2YgbW9kZWwgPT0gJ3N0cmluZycgfHwgdHlwZW9mIG1vZGVsID09ICdudW1iZXInKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1vZGVsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHZhdWx0OiBtb2RlbC5nZXQoJ3NsdWcnKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcblxuICAgICAgICBhY3Rpb25zOiB7XG4gICAgICAgICAgICBkZWxldGVWYXVsdDogZnVuY3Rpb24gKHZhdWx0KSB7XG4gICAgICAgICAgICAgICAgVmF1bHRpZXIuY29uZmlybU1vZGFsKHRoaXMsICdBcmUgeW91IHN1cmU/JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZSA9IHZhdWx0XG4gICAgICAgICAgICAgICAgICAgICAgICAuZGVsZXRlUmVjb3JkKClcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5ub3RpZnkoJ1lvdXIgdmF1bHQgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGRlbGV0ZWQuJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2l0aW9uVG8oJ1dvcmtzcGFjZS5pbmRleCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5ub3RpZnkoJ09vb3VwcyEgU29tZXRoaW5nIHdlbnQgd3JvbmcuJywgJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICBBcHBsaWNhdGlvbkxvYWRlci5wcm9taXNlKHByb21pc2UpO1xuXG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuICAgIH0pO1xuXG5WYXVsdGllci5WYXVsdEluZGV4Um91dGUgPSBFbWJlci5Sb3V0ZS5leHRlbmQoXG4gICAgVmF1bHRpZXIuV29ya3NwYWNlS2V5c01peGluLFxuICAgIHtcbiAgICAgICAgYmVmb3JlTW9kZWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrV29ya3NwYWNlS2V5cygpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50cmFuc2l0aW9uVG8oJ0NhcmRzLmluZGV4Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbiIsIlZhdWx0aWVyLlZhdWx0RWRpdFJvdXRlID0gRW1iZXIuUm91dGUuZXh0ZW5kKFxyXG4gICAgVmF1bHRpZXIuV29ya3NwYWNlS2V5c01peGluLFxyXG4gICAge1xyXG5cclxuICAgICAgICBiZWZvcmVNb2RlbDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tXb3Jrc3BhY2VLZXlzKCk7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgbW9kZWw6IGZ1bmN0aW9uIChwYXJhbXMsIHRyYW5zaXRpb24pIHtcclxuICAgICAgICAgICAgdmFyIHZhdWx0ID0gdGhpcy5tb2RlbEZvcignVmF1bHQnKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5nZXQoJ2F1dGgnKS5jaGVja1Blcm1pc3Npb25zKHRyYW5zaXRpb24sIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB2YXVsdC5nZXQoJ3Blcm1zLnVwZGF0ZScpO1xyXG4gICAgICAgICAgICB9LmJpbmQodGhpcyksIHRydWUpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB2YXVsdFxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHNldHVwQ29udHJvbGxlcjogZnVuY3Rpb24gKGN0cmwsIG1vZGVsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGN0cmwsIG1vZGVsKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBlbnZpcm9ubWVudCA9IHRoaXMuZ2V0KCdlbnZpcm9ubWVudCcpO1xyXG4gICAgICAgICAgICBlbnZpcm9ubWVudC5zZXQoJ3ZhdWx0JywgbW9kZWwpO1xyXG4gICAgICAgICAgICAvLyBzZXQgYnJlYWRjcnVtYnNcclxuICAgICAgICAgICAgY3RybC5zZXQoJ2JyZWFkY3J1bWJzJyxcclxuICAgICAgICAgICAgICAgIFZhdWx0aWVyLkJyZWFkY3J1bWJzLmNyZWF0ZSh7cm91dGVyOiB0aGlzLmdldCgncm91dGVyJyksIGVudmlyb25tZW50OiBlbnZpcm9ubWVudH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmFkZEhvbWUoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hZGRXb3Jrc3BhY2UoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hZGRWYXVsdCgpXHJcbiAgICAgICAgICAgICAgICAgICAgLmFkZFRleHQoJ0VkaXQgdmF1bHQnKVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgYWN0aW9uczoge1xyXG4gICAgICAgICAgICBzYXZlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVjb3JkID0gdGhpcy5nZXQoJ2NvbnRyb2xsZXIuY29udGVudCcpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHByb21pc2UgPSByZWNvcmRcclxuICAgICAgICAgICAgICAgICAgICAuc2F2ZVJlY29yZCgpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkLm5vdGlmeSgnWW91ciBjaGFuZ2VzIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBzYXZlZC4nLCAnc3VjY2VzcycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5LmdvKC0xKTtcclxuICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkLm5vdGlmeSgnT29vdXBzISBTb21ldGhpbmcgd2VudCB3cm9uZy4nLCAnZXJyb3InKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXQoJ2Vycm9ycycpLmxvZ0Vycm9yKGVycm9yKVxyXG4gICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSlcclxuXHJcbiAgICAgICAgICAgICAgICAgQXBwbGljYXRpb25Mb2FkZXIucHJvbWlzZShwcm9taXNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuXHJcblZhdWx0aWVyLlZhdWx0RWRpdENvbnRyb2xsZXIgPSBFbWJlci5PYmplY3RDb250cm9sbGVyLmV4dGVuZCh7XHJcbiAgICBicmVhZGNydW1iczogbnVsbFxyXG59KTtcclxuXHJcblZhdWx0aWVyLlZhdWx0RWRpdFZpZXcgPSBFbWJlci5WaWV3LmV4dGVuZCh7XHJcbiAgICB0ZW1wbGF0ZU5hbWU6ICdWYXVsdC9WYXVsdEVkaXQnLFxyXG4gICAgbGF5b3V0TmFtZTogJ0xheW91dC9MYXlvdXRTdGFuZGFyZCdcclxufSk7XHJcbiIsIlZhdWx0aWVyLlZhdWx0TWVtYmVySW5kZXhSb3V0ZSA9IFZhdWx0aWVyLk1lbWJlckluZGV4Um91dGUuZXh0ZW5kKFxuICAgIFZhdWx0aWVyLldvcmtzcGFjZUtleXNNaXhpbixcbiAgICB7XG4gICAgICAgIGJlZm9yZU1vZGVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmNoZWNrV29ya3NwYWNlS2V5cygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldHVwSW52aXRlRGF0YTogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgdmFyIHZhdWx0ID0gdGhpcy5tb2RlbEZvcignVmF1bHQnKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaW52aXRlT2JqZWN0OiB2YXVsdFxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldHVwQmxvY2tzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4ge3dvcmtzcGFjZTogdHJ1ZSwgdmF1bHQ6IHRydWV9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0dXBCcmVhZGNydW1iczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIFZhdWx0aWVyLkJyZWFkY3J1bWJzLmNyZWF0ZSh7cm91dGVyOiB0aGlzLmdldCgncm91dGVyJyksIGVudmlyb25tZW50OiB0aGlzLmdldCgnZW52aXJvbm1lbnQnKX0pXG4gICAgICAgICAgICAgICAgLmFkZEhvbWUoKVxuICAgICAgICAgICAgICAgIC5hZGRXb3Jrc3BhY2UoKVxuICAgICAgICAgICAgICAgIC5hZGRWYXVsdCgpXG4gICAgICAgICAgICAgICAgLmFkZENvbGxhYm9yYXRvcnNJbmRleCgnVmF1bHQubWVtYmVySW5kZXgnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXR1cEludml0ZVJvdXRlOiBmdW5jdGlvbiAobW9kZWxzKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGludml0ZVJvdXRlTmFtZTogJ1ZhdWx0Lm1lbWJlckludml0ZSdcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgIH0pO1xuXG5cblZhdWx0aWVyLlZhdWx0TWVtYmVySW5kZXhDb250cm9sbGVyID0gVmF1bHRpZXIuTWVtYmVySW5kZXhDb250cm9sbGVyLmV4dGVuZCh7XG59KTtcblxuXG5WYXVsdGllci5WYXVsdE1lbWJlckludml0ZVJvdXRlID0gVmF1bHRpZXIuTWVtYmVySW52aXRlUm91dGUuZXh0ZW5kKFxuICAgIFZhdWx0aWVyLldvcmtzcGFjZUtleXNNaXhpbixcbiAgICB7XG5cbiAgICAgICAgYmVmb3JlTW9kZWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuY2hlY2tXb3Jrc3BhY2VLZXlzKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIG92ZXJyaWRlIHRoaXMgdG8gc2V0dXAgaW52aXRlIHdvcmtzcGFjZSBhbmQgaW52aXRlIHRvIG9iamVjdFxuICAgICAgICAgKi9cbiAgICAgICAgc2V0dXBJbnZpdGVEYXRhOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICB2YXIgdmF1bHQgPSB0aGlzLm1vZGVsRm9yKCdWYXVsdCcpO1xuICAgICAgICAgICAgdmFyIHdvcmtzcGFjZSA9IHRoaXMubW9kZWxGb3IoJ1dvcmtzcGFjZScpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBpbnZpdGVPYmplY3Q6IHZhdWx0LFxuICAgICAgICAgICAgICAgIGludml0ZVBhcmFtczogeyB0b192YXVsdDogdmF1bHR9LFxuICAgICAgICAgICAgICAgIGludml0ZVdvcmtzcGFjZTogd29ya3NwYWNlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0dXBCcmVhZGNydW1iczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIFZhdWx0aWVyLkJyZWFkY3J1bWJzLmNyZWF0ZSh7cm91dGVyOiB0aGlzLmdldCgncm91dGVyJyksIGVudmlyb25tZW50OiB0aGlzLmdldCgnZW52aXJvbm1lbnQnKX0pXG4gICAgICAgICAgICAgICAgLmFkZEhvbWUoKVxuICAgICAgICAgICAgICAgIC5hZGRXb3Jrc3BhY2UoKVxuICAgICAgICAgICAgICAgIC5hZGRWYXVsdCgpXG4gICAgICAgICAgICAgICAgLmFkZENvbGxhYm9yYXRvcnNJbmRleCgnVmF1bHQubWVtYmVySW5kZXgnKVxuICAgICAgICAgICAgICAgIC5hZGRDb2xsYWJvcmF0b3JzSW52aXRlKCdWYXVsdC5tZW1iZXJJbnZpdGUnKTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG5cblZhdWx0aWVyLlZhdWx0TWVtYmVySW52aXRlQ29udHJvbGxlciA9IFZhdWx0aWVyLk1lbWJlckludml0ZUNvbnRyb2xsZXIuZXh0ZW5kKHtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9