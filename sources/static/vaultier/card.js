Vaultier.CardsIndexRoute=Ember.Route.extend(Vaultier.WorkspaceKeysMixin,{beforeModel:function(){this.checkWorkspaceKeys()},model:function(){var e=this.modelFor("Vault"),t=this.modelFor("Workspace"),r=this.get("store"),a=r.find("Card",{vault:e.get("id")}),o=Ember.RSVP.hash({to_workspace:r.find("Role",{to_workspace:t.get("id")}),to_vault:r.find("Role",{to_vault:e.get("id")})}).then(function(e){return[].concat(e.to_workspace.toArray(),e.to_vault.toArray())});return Ember.RSVP.hash({cards:a,memberships:o})},setupController:function(e,t){this.get("environment");e.set("content",t.cards),e.set("memberships",t.memberships);var r=this.modelFor("Workspace");this.set("workspace",r),e.set("workspace",r);var a=this.modelFor("Vault");this.set("vault",a),e.set("vault",a),e.set("breadcrumbs",Vaultier.Breadcrumbs.create({router:this.get("router"),environment:this.get("environment")}).addHome().addWorkspace().addVault())}}),Vaultier.CardsIndexController=Ember.ArrayController.extend({workspace:null,vault:null,sortProperties:["name"],sortAscending:!0,actions:{createCard:function(){this.set("sortAscending",!this.get("sortAscending"))}}}),Vaultier.CardsIndexView=Ember.View.extend({templateName:"Card/CardsIndex",layoutName:"Layout/LayoutStandard"}),Vaultier.CardsIndexItemView=Ember.View.extend({templateName:"Card/CardsIndexItem"});
Vaultier.CardsCreateRoute=Ember.Route.extend(Vaultier.WorkspaceKeysMixin,{beforeModel:function(){this.checkWorkspaceKeys()},model:function(e,t){var r=this.get("store"),a=this.modelFor("Workspace"),o=this.modelFor("Vault");if(this.get("auth").checkPermissions(t,function(){return o.get("perms.create")}.bind(this),!0)){var s=r.createRecord("Card"),n=Ember.RSVP.hash({to_workspace:r.find("Role",{to_workspace:a.get("id")}),to_vault:r.find("Role",{to_vault:o.get("id")})}).then(function(e){return[].concat(e.to_workspace.toArray(),e.to_vault.toArray())});return Ember.RSVP.hash({card:s,memberships:n})}},actions:{save:function(){var e=(this.get("workspace"),this.get("vault")),t=this.get("controller.content");t.set("vault",e.get("id"));var r=t.saveRecord().then(function(){$.notify("Your card has been successfully created.","success"),this.transitionTo("Card.index",t)}.bind(this),function(){$.notify("Oooups! Something went wrong.","error")});ApplicationLoader.promise(r)}},setupController:function(e,t){e.set("content",t.card),e.set("memberships",t.memberships);var r=this.modelFor("Workspace");this.set("workspace",r),e.set("workspace",r);var a=this.modelFor("Vault");this.set("vault",a),e.set("vault",a),e.set("breadcrumbs",Vaultier.Breadcrumbs.create({router:this.get("router"),environment:this.get("environment")}).addHome().addWorkspace().addVault().addText("Create new card"))}}),Vaultier.CardsCreateController=Ember.ObjectController.extend({breadcrumbs:null,workspace:null,vault:null}),Vaultier.CardsCreateView=Ember.View.extend({templateName:"Card/CardsCreate",layoutName:"Layout/LayoutStandard"});
Vaultier.CardEditRoute=Ember.Route.extend(Vaultier.WorkspaceKeysMixin,{beforeModel:function(){this.checkWorkspaceKeys()},model:function(e,t){var r=this.modelFor("Card");if(this.get("auth").checkPermissions(t,function(){return r.get("perms.update")}.bind(this),!0))return r},setupController:function(e,t){this._super(e,t);var r=this.get("environment");e.set("breadcrumbs",Vaultier.Breadcrumbs.create({router:this.get("router"),environment:r}).addHome().addWorkspace().addVault().addCard().addText("Edit card"))},actions:{save:function(){var e=this.get("controller.content"),t=e.saveRecord().then(function(){$.notify("Your changes has been successfully saved.","success"),history.go(-1)}.bind(this),function(){$.notify("Oooups! Something went wrong.","error")});ApplicationLoader.promise(t)}}}),Vaultier.CardEditController=Ember.ObjectController.extend({breadcrumbs:null}),Vaultier.CardEditView=Ember.View.extend({templateName:"Card/CardEdit",layoutName:"Layout/LayoutStandard"});
Vaultier.CardRoute=Ember.Route.extend(Vaultier.WorkspaceKeysMixin,{beforeModel:function(){this.checkWorkspaceKeys()},model:function(e){var t=this.modelFor("Vault"),r=this.get("store").find("Card",e.card).then(function(e){if(e.get("vault")!=t.get("id")){var r=new Error;throw r.status=404,r}return e});return r},actions:{deleteCard:function(e){var t=this.modelFor("Vault");Vaultier.confirmModal(this,"Are you sure?",function(){var r=e.deleteRecord().then(function(){$.notify("Your card has been successfully deleted.","success"),this.transitionTo("Cards.index",t)}.bind(this),function(){e.rollback(),$.notify("Oooups! Something went wrong.","error")}.bind(this));ApplicationLoader.promise(r)}.bind(this))}},afterModel:function(e){this.get("environment").set("card",e)},serialize:function(e){return"string"==typeof e||"number"==typeof e?e:{card:e.get("slug")}}}),Vaultier.CardIndexRoute=Ember.Route.extend({beforeModel:function(){this.transitionTo("Secret.index")}});
Vaultier.CardMemberIndexRoute=Vaultier.MemberIndexRoute.extend(Vaultier.WorkspaceKeysMixin,{beforeModel:function(){this.checkWorkspaceKeys()},setupInviteData:function(){var e=this.modelFor("Card");return{inviteObject:e}},setupBlocks:function(){return{workspace:!0,vault:!0,card:!0}},setupBreadcrumbs:function(){return Vaultier.Breadcrumbs.create({router:this.get("router"),environment:this.get("environment")}).addHome().addWorkspace().addVault().addCard().addCollaboratorsIndex("Card.memberIndex")},setupInviteRoute:function(){return{inviteRouteName:"Card.memberInvite"}},setupRoleLevels:function(){var e=Vaultier.Role.proto().roles.toArray().filter(function(e){return"CREATE"==e.id?!1:e});return e}}),Vaultier.CardMemberIndexController=Vaultier.MemberIndexController.extend({}),Vaultier.CardMemberInviteRoute=Vaultier.MemberInviteRoute.extend(Vaultier.WorkspaceKeysMixin,{beforeModel:function(){this.checkWorkspaceKeys()},setupInviteData:function(){var e=this.modelFor("Card"),r=this.modelFor("Workspace");return{inviteObject:e,inviteParams:{to_card:e},inviteWorkspace:r}},setupBreadcrumbs:function(){return Vaultier.Breadcrumbs.create({router:this.get("router"),environment:this.get("environment")}).addHome().addWorkspace().addVault().addCard().addCollaboratorsIndex("Card.memberIndex").addCollaboratorsInvite("Card.memberInvite")},setupRoleLevels:function(){var e=Vaultier.Role.proto().roles.toArray().filter(function(e){return"CREATE"==e.id?!1:e});return e}}),Vaultier.CardMemberInviteController=Vaultier.MemberInviteController.extend({});
Vaultier.CardVaultNodeView=Ember.Tree.TreeNodeView.extend({templateName:"Card/CardMoveVaultNode",Radio:Ember.View.extend({tagName:"input",type:"radio",attributeBindings:["type","name","value"],click:function(){this.get("controller").send("selected",this.$().val())}}),loadData:function(){return[]}}),Vaultier.CardMoveRoute=Ember.Route.extend(Vaultier.WorkspaceKeysMixin,{beforeModel:function(){this.checkWorkspaceKeys()},model:function(){var e=this.get("store"),t=this.modelFor("Workspace"),r=e.find("Vault",{workspace:t.get("id")}).then(function(e){return e.forEach(function(e){e.set("branch",!0)}),e});return r},setupController:function(e,t){var r=this.modelFor("Card");e.set("content",r),e.set("treeNodes",t),e.set("breadcrumbs",Vaultier.Breadcrumbs.create({router:this.get("router")}).addHome().addWorkspace().addVault().addCard().addText("Move card"))},actions:{save:function(){var e=this.get("controller.content");e.set("vault",this.get("controller.selected"));var t=e.saveRecord().then(function(){return this.get("store").find("Vault",e.get("vault"))}.bind(this)).then(function(e){$.notify("Your card has been successfully moved.","success"),this.transitionTo("Secret.index",this.modelFor("Workspace").get("slug"),e.get("slug"),this.modelFor("Card").get("slug"))}.bind(this),function(){$.notify("Oooups! Something went wrong.","error")});ApplicationLoader.promise(t)}}}),Vaultier.CardMoveController=Ember.ObjectController.extend({moveDisabled:function(){return!this.get("selected")}.property("selected"),selected:!1,breadcrumbs:null,actions:{selected:function(e){this.set("selected",e)}}}),Vaultier.CardMoveView=Ember.View.extend({templateName:"Card/CardMove",layoutName:"Layout/LayoutStandard",Tree:Ember.Tree.TreeView.extend({itemViewClass:Vaultier.CardVaultNodeView})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNhcmRzSW5kZXguanMiLCJDYXJkc0NyZWF0ZS5qcyIsIkNhcmRFZGl0LmpzIiwiQ2FyZEluZGV4LmpzIiwiQ2FyZE1lbWJlci5qcyIsIkNhcmRNb3ZlLmpzIl0sIm5hbWVzIjpbIlZhdWx0aWVyIiwiQ2FyZHNJbmRleFJvdXRlIiwiRW1iZXIiLCJSb3V0ZSIsImV4dGVuZCIsIldvcmtzcGFjZUtleXNNaXhpbiIsImJlZm9yZU1vZGVsIiwidGhpcyIsImNoZWNrV29ya3NwYWNlS2V5cyIsIm1vZGVsIiwidmF1bHQiLCJtb2RlbEZvciIsIndvcmtzcGFjZSIsInN0b3JlIiwiZ2V0IiwiY2FyZHMiLCJmaW5kIiwibWVtYmVyc2hpcHMiLCJSU1ZQIiwiaGFzaCIsInRvX3dvcmtzcGFjZSIsInRvX3ZhdWx0IiwidGhlbiIsImNvbmNhdCIsInRvQXJyYXkiLCJzZXR1cENvbnRyb2xsZXIiLCJjdHJsIiwic2V0IiwiQnJlYWRjcnVtYnMiLCJjcmVhdGUiLCJyb3V0ZXIiLCJlbnZpcm9ubWVudCIsImFkZEhvbWUiLCJhZGRXb3Jrc3BhY2UiLCJhZGRWYXVsdCIsIkNhcmRzSW5kZXhDb250cm9sbGVyIiwiQXJyYXlDb250cm9sbGVyIiwic29ydFByb3BlcnRpZXMiLCJzb3J0QXNjZW5kaW5nIiwiYWN0aW9ucyIsImNyZWF0ZUNhcmQiLCJDYXJkc0luZGV4VmlldyIsIlZpZXciLCJ0ZW1wbGF0ZU5hbWUiLCJsYXlvdXROYW1lIiwiQ2FyZHNJbmRleEl0ZW1WaWV3IiwiQ2FyZHNDcmVhdGVSb3V0ZSIsInBhcmFtcyIsInRyYW5zaXRpb24iLCJjaGVja1Blcm1pc3Npb25zIiwiYmluZCIsImNhcmQiLCJjcmVhdGVSZWNvcmQiLCJzYXZlIiwicmVjb3JkIiwicHJvbWlzZSIsInNhdmVSZWNvcmQiLCIkIiwibm90aWZ5IiwidHJhbnNpdGlvblRvIiwiQXBwbGljYXRpb25Mb2FkZXIiLCJhZGRUZXh0IiwiQ2FyZHNDcmVhdGVDb250cm9sbGVyIiwiT2JqZWN0Q29udHJvbGxlciIsImJyZWFkY3J1bWJzIiwiQ2FyZHNDcmVhdGVWaWV3IiwiQ2FyZEVkaXRSb3V0ZSIsIl9zdXBlciIsImFkZENhcmQiLCJoaXN0b3J5IiwiZ28iLCJDYXJkRWRpdENvbnRyb2xsZXIiLCJDYXJkRWRpdFZpZXciLCJDYXJkUm91dGUiLCJlcnJvciIsIkVycm9yIiwic3RhdHVzIiwiZGVsZXRlQ2FyZCIsInBhcmVudFZhdWx0IiwiY29uZmlybU1vZGFsIiwiZGVsZXRlUmVjb3JkIiwicm9sbGJhY2siLCJhZnRlck1vZGVsIiwic2VyaWFsaXplIiwiQ2FyZEluZGV4Um91dGUiLCJDYXJkTWVtYmVySW5kZXhSb3V0ZSIsIk1lbWJlckluZGV4Um91dGUiLCJzZXR1cEludml0ZURhdGEiLCJpbnZpdGVPYmplY3QiLCJzZXR1cEJsb2NrcyIsInNldHVwQnJlYWRjcnVtYnMiLCJhZGRDb2xsYWJvcmF0b3JzSW5kZXgiLCJzZXR1cEludml0ZVJvdXRlIiwiaW52aXRlUm91dGVOYW1lIiwic2V0dXBSb2xlTGV2ZWxzIiwibGV2ZWxzIiwiUm9sZSIsInByb3RvIiwicm9sZXMiLCJmaWx0ZXIiLCJpdGVtIiwiaWQiLCJDYXJkTWVtYmVySW5kZXhDb250cm9sbGVyIiwiTWVtYmVySW5kZXhDb250cm9sbGVyIiwiQ2FyZE1lbWJlckludml0ZVJvdXRlIiwiTWVtYmVySW52aXRlUm91dGUiLCJpbnZpdGVQYXJhbXMiLCJ0b19jYXJkIiwiaW52aXRlV29ya3NwYWNlIiwiYWRkQ29sbGFib3JhdG9yc0ludml0ZSIsIkNhcmRNZW1iZXJJbnZpdGVDb250cm9sbGVyIiwiTWVtYmVySW52aXRlQ29udHJvbGxlciIsIkNhcmRWYXVsdE5vZGVWaWV3IiwiVHJlZSIsIlRyZWVOb2RlVmlldyIsIlJhZGlvIiwidGFnTmFtZSIsInR5cGUiLCJhdHRyaWJ1dGVCaW5kaW5ncyIsImNsaWNrIiwic2VuZCIsInZhbCIsImxvYWREYXRhIiwiQ2FyZE1vdmVSb3V0ZSIsInZhdWx0cyIsImZvckVhY2giLCJDYXJkTW92ZUNvbnRyb2xsZXIiLCJtb3ZlRGlzYWJsZWQiLCJwcm9wZXJ0eSIsInNlbGVjdGVkIiwiQ2FyZE1vdmVWaWV3IiwiVHJlZVZpZXciLCJpdGVtVmlld0NsYXNzIl0sIm1hcHBpbmdzIjoiQUFBQUEsU0FBU0MsZ0JBQWtCQyxNQUFNQyxNQUFNQyxPQUNuQ0osU0FBU0ssb0JBRUxDLFlBQWEsV0FDVEMsS0FBS0Msc0JBR1RDLE1BQU8sV0FDSCxHQUFJQyxHQUFRSCxLQUFLSSxTQUFTLFNBQ3RCQyxFQUFZTCxLQUFLSSxTQUFTLGFBQzFCRSxFQUFRTixLQUFLTyxJQUFJLFNBR2pCQyxFQUFRRixFQUFNRyxLQUFLLFFBQVNOLE1BQU9BLEVBQU1JLElBQUksUUFHN0NHLEVBQWNmLE1BQU1nQixLQUNuQkMsTUFDR0MsYUFBY1AsRUFBTUcsS0FBSyxRQUFTSSxhQUFjUixFQUFVRSxJQUFJLFFBQzlETyxTQUFVUixFQUFNRyxLQUFLLFFBQVNLLFNBQVVYLEVBQU1JLElBQUksVUFFckRRLEtBQUssU0FBVUwsR0FDWixTQUFVTSxPQUFPTixFQUFZRyxhQUFhSSxVQUFXUCxFQUFZSSxTQUFTRyxZQUlsRixPQUFPdEIsT0FBTWdCLEtBQUtDLE1BQ2RKLE1BQU9BLEVBQ1BFLFlBQWFBLEtBSXJCUSxnQkFBaUIsU0FBVUMsRUFBTWpCLEdBQ1hGLEtBQUtPLElBQUksY0FFM0JZLEdBQUtDLElBQUksVUFBV2xCLEVBQU1NLE9BQzFCVyxFQUFLQyxJQUFJLGNBQWVsQixFQUFNUSxZQUc5QixJQUFJTCxHQUFZTCxLQUFLSSxTQUFTLFlBQzlCSixNQUFLb0IsSUFBSSxZQUFhZixHQUN0QmMsRUFBS0MsSUFBSSxZQUFhZixFQUd0QixJQUFJRixHQUFRSCxLQUFLSSxTQUFTLFFBQzFCSixNQUFLb0IsSUFBSSxRQUFTakIsR0FDbEJnQixFQUFLQyxJQUFJLFFBQVNqQixHQUdsQmdCLEVBQUtDLElBQUksY0FDTDNCLFNBQVM0QixZQUFZQyxRQUFRQyxPQUFRdkIsS0FBS08sSUFBSSxVQUFXaUIsWUFBYXhCLEtBQUtPLElBQUksaUJBQzFFa0IsVUFDQUMs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SCxLQUFLb0IsSUFBSSxXQUFZOEYsT0FLakN6SCxTQUFTa0ksYUFBZWhJLE1BQU13QyxLQUFLdEMsUUFDL0J1QyxhQUFjLGdCQUNkQyxXQUFZLHdCQUNacUUsS0FBTS9HLE1BQU0rRyxLQUFLa0IsU0FBUy9ILFFBQ3RCZ0ksY0FBZXBJLFNBQVNnSCIsImZpbGUiOiJjYXJkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiVmF1bHRpZXIuQ2FyZHNJbmRleFJvdXRlID0gRW1iZXIuUm91dGUuZXh0ZW5kKFxuICAgIFZhdWx0aWVyLldvcmtzcGFjZUtleXNNaXhpbixcbiAgICB7XG4gICAgICAgIGJlZm9yZU1vZGVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmNoZWNrV29ya3NwYWNlS2V5cygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG1vZGVsOiBmdW5jdGlvbiAocGFyYW1zLCB0cmFuc2l0aW9uKSB7XG4gICAgICAgICAgICB2YXIgdmF1bHQgPSB0aGlzLm1vZGVsRm9yKCdWYXVsdCcpO1xuICAgICAgICAgICAgdmFyIHdvcmtzcGFjZSA9IHRoaXMubW9kZWxGb3IoJ1dvcmtzcGFjZScpO1xuICAgICAgICAgICAgdmFyIHN0b3JlID0gdGhpcy5nZXQoJ3N0b3JlJyk7XG5cbiAgICAgICAgICAgIC8vIGxvYWQgY2FyZHNcbiAgICAgICAgICAgIHZhciBjYXJkcyA9IHN0b3JlLmZpbmQoJ0NhcmQnLCB7dmF1bHQ6IHZhdWx0LmdldCgnaWQnKX0pO1xuXG4gICAgICAgICAgICAvLyBsb2FkIG1lbWJlcnNoaXBzXG4gICAgICAgICAgICB2YXIgbWVtYmVyc2hpcHMgPSBFbWJlci5SU1ZQXG4gICAgICAgICAgICAgICAgLmhhc2goe1xuICAgICAgICAgICAgICAgICAgICB0b193b3Jrc3BhY2U6IHN0b3JlLmZpbmQoJ1JvbGUnLCB7dG9fd29ya3NwYWNlOiB3b3Jrc3BhY2UuZ2V0KCdpZCcpIH0pLFxuICAgICAgICAgICAgICAgICAgICB0b192YXVsdDogc3RvcmUuZmluZCgnUm9sZScsIHt0b192YXVsdDogdmF1bHQuZ2V0KCdpZCcpfSlcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChtZW1iZXJzaGlwcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gW10uY29uY2F0KG1lbWJlcnNoaXBzLnRvX3dvcmtzcGFjZS50b0FycmF5KCksIG1lbWJlcnNoaXBzLnRvX3ZhdWx0LnRvQXJyYXkoKSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAvLyByZXR1cm4gcHJvbWlzZSBmb3IgYWxsIHJlcXVlc3RzXG4gICAgICAgICAgICByZXR1cm4gRW1iZXIuUlNWUC5oYXNoKHtcbiAgICAgICAgICAgICAgICBjYXJkczogY2FyZHMsXG4gICAgICAgICAgICAgICAgbWVtYmVyc2hpcHM6IG1lbWJlcnNoaXBzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXR1cENvbnRyb2xsZXI6IGZ1bmN0aW9uIChjdHJsLCBtb2RlbCkge1xuICAgICAgICAgICAgdmFyIGVudmlyb25tZW50ID0gdGhpcy5nZXQoJ2Vudmlyb25tZW50Jyk7XG4gICAgICAgICAgICAvLyBzZXQgbW9kZWxcbiAgICAgICAgICAgIGN0cmwuc2V0KCdjb250ZW50JywgbW9kZWwuY2FyZHMpO1xuICAgICAgICAgICAgY3RybC5zZXQoJ21lbWJlcnNoaXBzJywgbW9kZWwubWVtYmVyc2hpcHMpO1xuXG4gICAgICAgICAgICAvLyByZXRyaWV2ZSB3b3Jrc3BhY2VcbiAgICAgICAgICAgIHZhciB3b3Jrc3BhY2UgPSB0aGlzLm1vZGVsRm9yKCdXb3Jrc3BhY2UnKTtcbiAgICAgICAgICAgIHRoaXMuc2V0KCd3b3Jrc3BhY2UnLCB3b3Jrc3BhY2UpO1xuICAgICAgICAgICAgY3RybC5zZXQoJ3dvcmtzcGFjZScsIHdvcmtzcGFjZSk7XG5cbiAgICAgICAgICAgIC8vIHJldHJpZXZlIHZhdWx0XG4gICAgICAgICAgICB2YXIgdmF1bHQgPSB0aGlzLm1vZGVsRm9yKCdWYXVsdCcpO1xuICAgICAgICAgICAgdGhpcy5zZXQoJ3ZhdWx0JywgdmF1bHQpO1xuICAgICAgICAgICAgY3RybC5zZXQoJ3ZhdWx0JywgdmF1bHQpO1xuXG4gICAgICAgICAgICAvLyBzZXQgYnJlYWRjcnVtYnNcbiAgICAgICAgICAgIGN0cmwuc2V0KCdicmVhZGNydW1icycsXG4gICAgICAgICAgICAgICAgVmF1bHRpZXIuQnJlYWRjcnVtYnMuY3JlYXRlKHtyb3V0ZXI6IHRoaXMuZ2V0KCdyb3V0ZXInKSwgZW52aXJvbm1lbnQ6IHRoaXMuZ2V0KCdlbnZpcm9ubWVudCcpfSlcbiAgICAgICAgICAgICAgICAgICAgLmFkZEhvbWUoKVxuICAgICAgICAgICAgICAgICAgICAuYWRkV29ya3NwYWNlKClcbiAgICAgICAgICAgICAgICAgICAgLmFkZFZhdWx0KClcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgIH0pO1xuXG5cblZhdWx0aWVyLkNhcmRzSW5kZXhDb250cm9sbGVyID0gRW1iZXIuQXJyYXlDb250cm9sbGVyLmV4dGVuZCh7XG4gICAgd29ya3NwYWNlOiBudWxsLFxuICAgIHZhdWx0OiBudWxsLFxuICAgIHNvcnRQcm9wZXJ0aWVzOiBbJ25hbWUnXSxcbiAgICBzb3J0QXNjZW5kaW5nOiB0cnVlLFxuICAgIGFjdGlvbnM6IHtcbiAgICAgICAgY3JlYXRlQ2FyZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5zZXQoJ3NvcnRBc2NlbmRpbmcnLCAhdGhpcy5nZXQoJ3NvcnRBc2NlbmRpbmcnKSk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxuXG5WYXVsdGllci5DYXJkc0luZGV4VmlldyA9IEVtYmVyLlZpZXcuZXh0ZW5kKHtcbiAgICB0ZW1wbGF0ZU5hbWU6ICdDYXJkL0NhcmRzSW5kZXgnLFxuICAgIGxheW91dE5hbWU6ICdMYXlvdXQvTGF5b3V0U3RhbmRhcmQnXG4vLyAgICBjb250cm9sbGVyOiBWYXVsdGllci5DYXJkTGlzdENvbnRyb2xsZXJcbn0pO1xuXG5cblZhdWx0aWVyLkNhcmRzSW5kZXhJdGVtVmlldyA9IEVtYmVyLlZpZXcuZXh0ZW5kKHtcbiAgICB0ZW1wbGF0ZU5hbWU6ICdDYXJkL0NhcmRzSW5kZXhJdGVtJ1xufSk7IiwiVmF1bHRpZXIuQ2FyZHNDcmVhdGVSb3V0ZSA9IEVtYmVyLlJvdXRlLmV4dGVuZChcbiAgICBWYXVsdGllci5Xb3Jrc3BhY2VLZXlzTWl4aW4sXG4gICAge1xuICAgICAgICBiZWZvcmVNb2RlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5jaGVja1dvcmtzcGFjZUtleXMoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBtb2RlbDogZnVuY3Rpb24gKHBhcmFtcywgdHJhbnNpdGlvbikge1xuICAgICAgICAgICAgdmFyIHN0b3JlID0gdGhpcy5nZXQoJ3N0b3JlJyk7XG4gICAgICAgICAgICB2YXIgd29ya3NwYWNlID0gdGhpcy5tb2RlbEZvcignV29ya3NwYWNlJyk7XG4gICAgICAgICAgICB2YXIgdmF1bHQgPSB0aGlzLm1vZGVsRm9yKCdWYXVsdCcpO1xuXG4gICAgICAgICAgICAvLyBjaGVjayBwZXJtaXNzaW9uc1xuICAgICAgICAgICAgaWYgKCF0aGlzLmdldCgnYXV0aCcpLmNoZWNrUGVybWlzc2lvbnModHJhbnNpdGlvbiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2YXVsdC5nZXQoJ3Blcm1zLmNyZWF0ZScpO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpLCB0cnVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gY3JlYXRlIHJlY29yZFxuICAgICAgICAgICAgdmFyIGNhcmQgPSBzdG9yZS5jcmVhdGVSZWNvcmQoJ0NhcmQnKTtcblxuICAgICAgICAgICAgLy8gbG9hZCBtZW1iZXJzaGlwc1xuICAgICAgICAgICAgdmFyIG1lbWJlcnNoaXBzID0gRW1iZXIuUlNWUFxuICAgICAgICAgICAgICAgIC5oYXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdG9fd29ya3NwYWNlOiBzdG9yZS5maW5kKCdSb2xlJywge3RvX3dvcmtzcGFjZTogd29ya3NwYWNlLmdldCgnaWQnKSB9KSxcbiAgICAgICAgICAgICAgICAgICAgdG9fdmF1bHQ6IHN0b3JlLmZpbmQoJ1JvbGUnLCB7dG9fdmF1bHQ6IHZhdWx0LmdldCgnaWQnKX0pXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAobWVtYmVyc2hpcHMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtdLmNvbmNhdChtZW1iZXJzaGlwcy50b193b3Jrc3BhY2UudG9BcnJheSgpLCBtZW1iZXJzaGlwcy50b192YXVsdC50b0FycmF5KCkpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyByZXR1cm4gcHJvbWlzZSBmb3IgYWxsIHJlcXVlc3RzXG4gICAgICAgICAgICByZXR1cm4gRW1iZXIuUlNWUC5oYXNoKHtcbiAgICAgICAgICAgICAgICBjYXJkOiBjYXJkLFxuICAgICAgICAgICAgICAgIG1lbWJlcnNoaXBzOiBtZW1iZXJzaGlwc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYWN0aW9uczoge1xuICAgICAgICAgICAgc2F2ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciB3b3Jrc3BhY2UgPSB0aGlzLmdldCgnd29ya3NwYWNlJyk7XG4gICAgICAgICAgICAgICAgdmFyIHZhdWx0ID0gdGhpcy5nZXQoJ3ZhdWx0Jyk7XG5cbiAgICAgICAgICAgICAgICB2YXIgcmVjb3JkID0gdGhpcy5nZXQoJ2NvbnRyb2xsZXIuY29udGVudCcpO1xuICAgICAgICAgICAgICAgIHJlY29yZC5zZXQoJ3ZhdWx0JywgdmF1bHQuZ2V0KCdpZCcpKTtcblxuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gcmVjb3JkXG4gICAgICAgICAgICAgICAgICAgIC5zYXZlUmVjb3JkKClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQubm90aWZ5KCdZb3VyIGNhcmQgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGNyZWF0ZWQuJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNpdGlvblRvKCdDYXJkLmluZGV4JywgcmVjb3JkKTtcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLm5vdGlmeSgnT29vdXBzISBTb21ldGhpbmcgd2VudCB3cm9uZy4nLCAnZXJyb3InKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICBBcHBsaWNhdGlvbkxvYWRlci5wcm9taXNlKHByb21pc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldHVwQ29udHJvbGxlcjogZnVuY3Rpb24gKGN0cmwsIG1vZGVsKSB7XG4gICAgICAgICAgICAvLyBzZXQgbW9kZWxcbiAgICAgICAgICAgIGN0cmwuc2V0KCdjb250ZW50JywgbW9kZWwuY2FyZCk7XG4gICAgICAgICAgICBjdHJsLnNldCgnbWVtYmVyc2hpcHMnLCBtb2RlbC5tZW1iZXJzaGlwcyk7XG5cbiAgICAgICAgICAgIC8vIHJldHJpZXZlIHdvcmtzcGFjZVxuICAgICAgICAgICAgdmFyIHdvcmtzcGFjZSA9IHRoaXMubW9kZWxGb3IoJ1dvcmtzcGFjZScpO1xuICAgICAgICAgICAgdGhpcy5zZXQoJ3dvcmtzcGFjZScsIHdvcmtzcGFjZSk7XG4gICAgICAgICAgICBjdHJsLnNldCgnd29ya3NwYWNlJywgd29ya3NwYWNlKTtcblxuICAgICAgICAgICAgLy8gcmV0cmlldmUgdmF1bHRcbiAgICAgICAgICAgIHZhciB2YXVsdCA9IHRoaXMubW9kZWxGb3IoJ1ZhdWx0Jyk7XG4gICAgICAgICAgICB0aGlzLnNldCgndmF1bHQnLCB2YXVsdCk7XG4gICAgICAgICAgICBjdHJsLnNldCgndmF1bHQnLCB2YXVsdCk7XG5cbiAgICAgICAgICAgIC8vIHNldCBicmVhZGNydW1ic1xuICAgICAgICAgICAgY3RybC5zZXQoJ2JyZWFkY3J1bWJzJyxcbiAgICAgICAgICAgICAgICBWYXVsdGllci5CcmVhZGNydW1icy5jcmVhdGUoe3JvdXRlcjogdGhpcy5nZXQoJ3JvdXRlcicpLCBlbnZpcm9ubWVudDogdGhpcy5nZXQoJ2Vudmlyb25tZW50Jyl9KVxuICAgICAgICAgICAgICAgICAgICAuYWRkSG9tZSgpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRXb3Jrc3BhY2UoKVxuICAgICAgICAgICAgICAgICAgICAuYWRkVmF1bHQoKVxuICAgICAgICAgICAgICAgICAgICAuYWRkVGV4dCgnQ3JlYXRlIG5ldyBjYXJkJylcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgfVxuXG4gICAgfSk7XG5cblZhdWx0aWVyLkNhcmRzQ3JlYXRlQ29udHJvbGxlciA9IEVtYmVyLk9iamVjdENvbnRyb2xsZXIuZXh0ZW5kKHtcbiAgICBicmVhZGNydW1iczogbnVsbCxcbiAgICB3b3Jrc3BhY2U6IG51bGwsXG4gICAgdmF1bHQ6IG51bGxcbn0pO1xuXG5WYXVsdGllci5DYXJkc0NyZWF0ZVZpZXcgPSBFbWJlci5WaWV3LmV4dGVuZCh7XG4gICAgdGVtcGxhdGVOYW1lOiAnQ2FyZC9DYXJkc0NyZWF0ZScsXG4gICAgbGF5b3V0TmFtZTogJ0xheW91dC9MYXlvdXRTdGFuZGFyZCdcbn0pOyIsIlZhdWx0aWVyLkNhcmRFZGl0Um91dGUgPSBFbWJlci5Sb3V0ZS5leHRlbmQoXHJcbiAgICBWYXVsdGllci5Xb3Jrc3BhY2VLZXlzTWl4aW4sXHJcbiAgICB7XHJcbiAgICAgICAgYmVmb3JlTW9kZWw6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdGhpcy5jaGVja1dvcmtzcGFjZUtleXMoKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBtb2RlbDogZnVuY3Rpb24gKHBhcmFtcywgdHJhbnNpdGlvbikge1xyXG4gICAgICAgICAgICB2YXIgY2FyZCA9IHRoaXMubW9kZWxGb3IoJ0NhcmQnKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghdGhpcy5nZXQoJ2F1dGgnKS5jaGVja1Blcm1pc3Npb25zKHRyYW5zaXRpb24sIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjYXJkLmdldCgncGVybXMudXBkYXRlJylcclxuICAgICAgICAgICAgfS5iaW5kKHRoaXMpLCB0cnVlKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY2FyZFxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHNldHVwQ29udHJvbGxlcjogZnVuY3Rpb24gKGN0cmwsIG1vZGVsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyKGN0cmwsIG1vZGVsKTtcclxuICAgICAgICAgICAgdmFyIGVudmlyb25tZW50ID0gdGhpcy5nZXQoJ2Vudmlyb25tZW50Jyk7XHJcblxyXG4gICAgICAgICAgICAvLyBzZXQgYnJlYWRjcnVtYnNcclxuICAgICAgICAgICAgY3RybC5zZXQoJ2JyZWFkY3J1bWJzJyxcclxuICAgICAgICAgICAgICAgIFZhdWx0aWVyLkJyZWFkY3J1bWJzLmNyZWF0ZSh7cm91dGVyOiB0aGlzLmdldCgncm91dGVyJyksIGVudmlyb25tZW50OiBlbnZpcm9ubWVudH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmFkZEhvbWUoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hZGRXb3Jrc3BhY2UoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hZGRWYXVsdCgpXHJcbiAgICAgICAgICAgICAgICAgICAgLmFkZENhcmQoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5hZGRUZXh0KCdFZGl0IGNhcmQnKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGFjdGlvbnM6IHtcclxuICAgICAgICAgICAgc2F2ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlY29yZCA9IHRoaXMuZ2V0KCdjb250cm9sbGVyLmNvbnRlbnQnKTtcclxuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gcmVjb3JkLnNhdmVSZWNvcmQoKS50aGVuKFxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJC5ub3RpZnkoJ1lvdXIgY2hhbmdlcyBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgc2F2ZWQuJywgJ3N1Y2Nlc3MnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGlzdG9yeS5nbygtMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLFxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJC5ub3RpZnkoJ09vb3VwcyEgU29tZXRoaW5nIHdlbnQgd3JvbmcuJywgJ2Vycm9yJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgICAgICBBcHBsaWNhdGlvbkxvYWRlci5wcm9taXNlKHByb21pc2UpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuVmF1bHRpZXIuQ2FyZEVkaXRDb250cm9sbGVyID0gRW1iZXIuT2JqZWN0Q29udHJvbGxlci5leHRlbmQoe1xyXG4gICAgYnJlYWRjcnVtYnM6IG51bGxcclxufSk7XHJcblxyXG5WYXVsdGllci5DYXJkRWRpdFZpZXcgPSBFbWJlci5WaWV3LmV4dGVuZCh7XHJcbiAgICB0ZW1wbGF0ZU5hbWU6ICdDYXJkL0NhcmRFZGl0JyxcclxuICAgIGxheW91dE5hbWU6ICdMYXlvdXQvTGF5b3V0U3RhbmRhcmQnXHJcbn0pO1xyXG4iLCJWYXVsdGllci5DYXJkUm91dGUgPSBFbWJlci5Sb3V0ZS5leHRlbmQoXG4gICAgVmF1bHRpZXIuV29ya3NwYWNlS2V5c01peGluLFxuICAgIHtcbiAgICAgICAgYmVmb3JlTW9kZWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuY2hlY2tXb3Jrc3BhY2VLZXlzKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgbW9kZWw6IGZ1bmN0aW9uIChwYXJhbXMsIHRyYW5zaXRpb24pIHtcbiAgICAgICAgICAgIHZhciB2YXVsdCA9IHRoaXMubW9kZWxGb3IoJ1ZhdWx0Jyk7XG4gICAgICAgICAgICB2YXIgbW9kZWwgPSB0aGlzLmdldCgnc3RvcmUnKVxuICAgICAgICAgICAgICAgIC5maW5kKCdDYXJkJywgcGFyYW1zLmNhcmQpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtb2RlbC5nZXQoJ3ZhdWx0JykgIT0gdmF1bHQuZ2V0KCdpZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSBuZXcgRXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yLnN0YXR1cyA9IDQwNDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtb2RlbDtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIG1vZGVsO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFjdGlvbnM6IHtcbiAgICAgICAgICAgIGRlbGV0ZUNhcmQ6IGZ1bmN0aW9uIChjYXJkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmVudFZhdWx0ID0gdGhpcy5tb2RlbEZvcignVmF1bHQnKTtcbiAgICAgICAgICAgICAgICBWYXVsdGllci5jb25maXJtTW9kYWwodGhpcywgJ0FyZSB5b3Ugc3VyZT8nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gY2FyZFxuICAgICAgICAgICAgICAgICAgICAgICAgLmRlbGV0ZVJlY29yZCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQubm90aWZ5KCdZb3VyIGNhcmQgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGRlbGV0ZWQuJywgJ3N1Y2Nlc3MnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zaXRpb25UbygnQ2FyZHMuaW5kZXgnLCBwYXJlbnRWYXVsdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXJkLnJvbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQubm90aWZ5KCdPb291cHMhIFNvbWV0aGluZyB3ZW50IHdyb25nLicsICdlcnJvcicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKVxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgQXBwbGljYXRpb25Mb2FkZXIucHJvbWlzZShwcm9taXNlKTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGFmdGVyTW9kZWw6IGZ1bmN0aW9uIChjYXJkKSB7XG4gICAgICAgICAgICB0aGlzLmdldCgnZW52aXJvbm1lbnQnKS5zZXQoJ2NhcmQnLCBjYXJkKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXJpYWxpemU6IGZ1bmN0aW9uIChtb2RlbCkge1xuICAgICAgICAgICAgLy8gcHJpbWl0aXZlc1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBtb2RlbCA9PSAnc3RyaW5nJyB8fCB0eXBlb2YgbW9kZWwgPT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbW9kZWw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgY2FyZDogbW9kZWwuZ2V0KCdzbHVnJylcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9KTtcblxuVmF1bHRpZXIuQ2FyZEluZGV4Um91dGUgPSBFbWJlci5Sb3V0ZS5leHRlbmQoe1xuICAgIGJlZm9yZU1vZGVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudHJhbnNpdGlvblRvKCdTZWNyZXQuaW5kZXgnKTtcbiAgICB9XG59KTtcbiIsIlZhdWx0aWVyLkNhcmRNZW1iZXJJbmRleFJvdXRlID0gVmF1bHRpZXIuTWVtYmVySW5kZXhSb3V0ZS5leHRlbmQoXG4gICAgVmF1bHRpZXIuV29ya3NwYWNlS2V5c01peGluLFxuICAgIHtcbiAgICAgICAgYmVmb3JlTW9kZWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuY2hlY2tXb3Jrc3BhY2VLZXlzKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0dXBJbnZpdGVEYXRhOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgICB2YXIgY2FyZCA9IHRoaXMubW9kZWxGb3IoJ0NhcmQnKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaW52aXRlT2JqZWN0OiBjYXJkXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldHVwQmxvY2tzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4ge3dvcmtzcGFjZTogdHJ1ZSwgdmF1bHQ6IHRydWUsIGNhcmQ6IHRydWV9O1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldHVwQnJlYWRjcnVtYnM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBWYXVsdGllci5CcmVhZGNydW1icy5jcmVhdGUoe3JvdXRlcjogdGhpcy5nZXQoJ3JvdXRlcicpLCBlbnZpcm9ubWVudDogdGhpcy5nZXQoJ2Vudmlyb25tZW50Jyl9KVxuICAgICAgICAgICAgICAgIC5hZGRIb21lKClcbiAgICAgICAgICAgICAgICAuYWRkV29ya3NwYWNlKClcbiAgICAgICAgICAgICAgICAuYWRkVmF1bHQoKVxuICAgICAgICAgICAgICAgIC5hZGRDYXJkKClcbiAgICAgICAgICAgICAgICAuYWRkQ29sbGFib3JhdG9yc0luZGV4KCdDYXJkLm1lbWJlckluZGV4Jyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0dXBJbnZpdGVSb3V0ZTogZnVuY3Rpb24gKG1vZGVscykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBpbnZpdGVSb3V0ZU5hbWU6ICdDYXJkLm1lbWJlckludml0ZSdcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0dXBSb2xlTGV2ZWxzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgbGV2ZWxzID0gVmF1bHRpZXIuUm9sZS5wcm90bygpLnJvbGVzLnRvQXJyYXkoKS5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uaWQgPT0gJ0NSRUFURScpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGxldmVscztcbiAgICAgICAgfVxuICAgIH0pO1xuXG5cblZhdWx0aWVyLkNhcmRNZW1iZXJJbmRleENvbnRyb2xsZXIgPSBWYXVsdGllci5NZW1iZXJJbmRleENvbnRyb2xsZXIuZXh0ZW5kKHtcbn0pO1xuXG5cblZhdWx0aWVyLkNhcmRNZW1iZXJJbnZpdGVSb3V0ZSA9IFZhdWx0aWVyLk1lbWJlckludml0ZVJvdXRlLmV4dGVuZChcbiAgICBWYXVsdGllci5Xb3Jrc3BhY2VLZXlzTWl4aW4sXG4gICAge1xuICAgICAgICBiZWZvcmVNb2RlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5jaGVja1dvcmtzcGFjZUtleXMoKTtcbiAgICAgICAgfSxcblxuXG4gICAgICAgIHNldHVwSW52aXRlRGF0YTogZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICAgICAgdmFyIGNhcmQgPSB0aGlzLm1vZGVsRm9yKCdDYXJkJyk7XG4gICAgICAgICAgICB2YXIgd29ya3NwYWNlID0gdGhpcy5tb2RlbEZvcignV29ya3NwYWNlJyk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGludml0ZU9iamVjdDogY2FyZCxcbiAgICAgICAgICAgICAgICBpbnZpdGVQYXJhbXM6IHsgdG9fY2FyZDogY2FyZH0sXG4gICAgICAgICAgICAgICAgaW52aXRlV29ya3NwYWNlOiB3b3Jrc3BhY2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZXR1cEJyZWFkY3J1bWJzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gVmF1bHRpZXIuQnJlYWRjcnVtYnMuY3JlYXRlKHtyb3V0ZXI6IHRoaXMuZ2V0KCdyb3V0ZXInKSwgZW52aXJvbm1lbnQ6IHRoaXMuZ2V0KCdlbnZpcm9ubWVudCcpfSlcbiAgICAgICAgICAgICAgICAuYWRkSG9tZSgpXG4gICAgICAgICAgICAgICAgLmFkZFdvcmtzcGFjZSgpXG4gICAgICAgICAgICAgICAgLmFkZFZhdWx0KClcbiAgICAgICAgICAgICAgICAuYWRkQ2FyZCgpXG4gICAgICAgICAgICAgICAgLmFkZENvbGxhYm9yYXRvcnNJbmRleCgnQ2FyZC5tZW1iZXJJbmRleCcpXG4gICAgICAgICAgICAgICAgLmFkZENvbGxhYm9yYXRvcnNJbnZpdGUoJ0NhcmQubWVtYmVySW52aXRlJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0dXBSb2xlTGV2ZWxzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgbGV2ZWxzID0gVmF1bHRpZXIuUm9sZS5wcm90bygpLnJvbGVzLnRvQXJyYXkoKS5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0uaWQgPT0gJ0NSRUFURScpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGxldmVscztcbiAgICAgICAgfVxuXG4gICAgfSk7XG5cblZhdWx0aWVyLkNhcmRNZW1iZXJJbnZpdGVDb250cm9sbGVyID0gVmF1bHRpZXIuTWVtYmVySW52aXRlQ29udHJvbGxlci5leHRlbmQoe1xufSk7XG4iLCJWYXVsdGllci5DYXJkVmF1bHROb2RlVmlldyA9IEVtYmVyLlRyZWUuVHJlZU5vZGVWaWV3LmV4dGVuZCh7XG4gICAgdGVtcGxhdGVOYW1lOiAnQ2FyZC9DYXJkTW92ZVZhdWx0Tm9kZScsXG4gICAgUmFkaW86IEVtYmVyLlZpZXcuZXh0ZW5kKHtcbiAgICAgICAgdGFnTmFtZTogXCJpbnB1dFwiLFxuICAgICAgICB0eXBlOiBcInJhZGlvXCIsXG4gICAgICAgIGF0dHJpYnV0ZUJpbmRpbmdzOiBbICBcInR5cGVcIiwgXCJuYW1lXCIsIFwidmFsdWVcIl0sXG4gICAgICAgIGNsaWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmdldCgnY29udHJvbGxlcicpLnNlbmQoJ3NlbGVjdGVkJywgdGhpcy4kKCkudmFsKCkpXG4gICAgICAgIH1cbiAgICB9KSxcbiAgICBsb2FkRGF0YTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gW11cbiAgICB9XG59KTtcblxuVmF1bHRpZXIuQ2FyZE1vdmVSb3V0ZSA9IEVtYmVyLlJvdXRlLmV4dGVuZChcbiAgICBWYXVsdGllci5Xb3Jrc3BhY2VLZXlzTWl4aW4sXG4gICAge1xuICAgICAgICBiZWZvcmVNb2RlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5jaGVja1dvcmtzcGFjZUtleXMoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBtb2RlbDogZnVuY3Rpb24gKHBhcmFtcywgdHJhbnNpdGlvbikge1xuICAgICAgICAgICAgdmFyIHN0b3JlID0gdGhpcy5nZXQoJ3N0b3JlJyk7XG4gICAgICAgICAgICB2YXIgd29ya3NwYWNlID0gdGhpcy5tb2RlbEZvcignV29ya3NwYWNlJyk7XG5cbiAgICAgICAgICAgIHZhciB2YXVsdHMgPVxuICAgICAgICAgICAgICAgIHN0b3JlLlxuICAgICAgICAgICAgICAgICAgICBmaW5kKCdWYXVsdCcsIHt3b3Jrc3BhY2U6IHdvcmtzcGFjZS5nZXQoJ2lkJyl9KVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAobW9kZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnNldCgnYnJhbmNoJywgdHJ1ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW9kZWxcbiAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgcmV0dXJuIHZhdWx0c1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldHVwQ29udHJvbGxlcjogZnVuY3Rpb24gKGN0cmwsIG1vZGVsKSB7XG4gICAgICAgICAgICB2YXIgY2FyZCA9IHRoaXMubW9kZWxGb3IoJ0NhcmQnKVxuXG4gICAgICAgICAgICBjdHJsLnNldCgnY29udGVudCcsIGNhcmQpO1xuICAgICAgICAgICAgY3RybC5zZXQoJ3RyZWVOb2RlcycsIG1vZGVsKTtcblxuICAgICAgICAgICAgLy8gc2V0IGJyZWFkY3J1bWJzXG4gICAgICAgICAgICBjdHJsLnNldCgnYnJlYWRjcnVtYnMnLFxuICAgICAgICAgICAgICAgIFZhdWx0aWVyLkJyZWFkY3J1bWJzLmNyZWF0ZSh7cm91dGVyOiB0aGlzLmdldCgncm91dGVyJyl9KVxuICAgICAgICAgICAgICAgICAgICAuYWRkSG9tZSgpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRXb3Jrc3BhY2UoKVxuICAgICAgICAgICAgICAgICAgICAuYWRkVmF1bHQoKVxuICAgICAgICAgICAgICAgICAgICAuYWRkQ2FyZCgpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRUZXh0KCdNb3ZlIGNhcmQnKVxuICAgICAgICAgICAgKVxuICAgICAgICB9LFxuXG4gICAgICAgIGFjdGlvbnM6IHtcblxuICAgICAgICAgICAgc2F2ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciByZWNvcmQgPSB0aGlzLmdldCgnY29udHJvbGxlci5jb250ZW50Jyk7XG4gICAgICAgICAgICAgICAgcmVjb3JkLnNldCgndmF1bHQnLCB0aGlzLmdldCgnY29udHJvbGxlci5zZWxlY3RlZCcpKVxuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gcmVjb3JkXG4gICAgICAgICAgICAgICAgICAgIC5zYXZlUmVjb3JkKClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCdzdG9yZScpLmZpbmQoJ1ZhdWx0JywgcmVjb3JkLmdldCgndmF1bHQnKSlcbiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAodmF1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgJC5ub3RpZnkoJ1lvdXIgY2FyZCBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgbW92ZWQuJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2l0aW9uVG8oXG4gICAgICAgICAgICAgICAgICAgICAgICAnU2VjcmV0LmluZGV4JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWxGb3IoJ1dvcmtzcGFjZScpLmdldCgnc2x1ZycpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmF1bHQuZ2V0KCdzbHVnJyksXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsRm9yKCdDYXJkJykuZ2V0KCdzbHVnJylcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5ub3RpZnkoJ09vb3VwcyEgU29tZXRoaW5nIHdlbnQgd3JvbmcuJywgJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApXG5cbiAgICAgICAgICAgICAgICBBcHBsaWNhdGlvbkxvYWRlci5wcm9taXNlKHByb21pc2UpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuVmF1bHRpZXIuQ2FyZE1vdmVDb250cm9sbGVyID0gRW1iZXIuT2JqZWN0Q29udHJvbGxlci5leHRlbmQoe1xuICAgIG1vdmVEaXNhYmxlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gIXRoaXMuZ2V0KCdzZWxlY3RlZCcpO1xuICAgIH0ucHJvcGVydHkoJ3NlbGVjdGVkJyksXG4gICAgc2VsZWN0ZWQ6IGZhbHNlLFxuICAgIGJyZWFkY3J1bWJzOiBudWxsLFxuICAgIGFjdGlvbnM6IHtcbiAgICAgICAgc2VsZWN0ZWQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0KCdzZWxlY3RlZCcsIHZhbCk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcblxuVmF1bHRpZXIuQ2FyZE1vdmVWaWV3ID0gRW1iZXIuVmlldy5leHRlbmQoe1xuICAgIHRlbXBsYXRlTmFtZTogJ0NhcmQvQ2FyZE1vdmUnLFxuICAgIGxheW91dE5hbWU6ICdMYXlvdXQvTGF5b3V0U3RhbmRhcmQnLFxuICAgIFRyZWU6IEVtYmVyLlRyZWUuVHJlZVZpZXcuZXh0ZW5kKHtcbiAgICAgICAgaXRlbVZpZXdDbGFzczogVmF1bHRpZXIuQ2FyZFZhdWx0Tm9kZVZpZXdcbiAgICB9KVxuXG59KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==